# ?? Change User Role to ADMIN

# This script changes the role of an existing user to ADMIN

# Configuration
$API_URL = "https://backrent-itx754fut5nry-app.purplepond-bd8ec00c.westeurope.azurecontainerapps.io/v1"
$userEmail = "maloni@outlook.com"
$userId = "69382e4818c06603d21fd095"

Write-Host "?? Changing user role to ADMIN..." -ForegroundColor Cyan
Write-Host "Email: $userEmail" -ForegroundColor Yellow
Write-Host "User ID: $userId" -ForegroundColor Yellow
Write-Host ""
Write-Host "??  Note: This operation requires ADMIN access or database access." -ForegroundColor Yellow
Write-Host ""

# Option 1: Direct MongoDB/Cosmos DB Update
Write-Host "???????????????????????????????????????????" -ForegroundColor Cyan
Write-Host "OPTION 1: Azure Cosmos DB (Recommended)" -ForegroundColor Green
Write-Host "???????????????????????????????????????????" -ForegroundColor Cyan
Write-Host ""
Write-Host "1. Open Azure Portal: https://portal.azure.com" -ForegroundColor White
Write-Host "2. Navigate to: Cosmos DB ? backrent-db ? Data Explorer" -ForegroundColor White
Write-Host "3. Select Database: 'backrent' ? Collection: 'users'" -ForegroundColor White
Write-Host "4. Find user with email: '$userEmail'" -ForegroundColor White
Write-Host "5. Click 'Edit' and change:" -ForegroundColor White
Write-Host "   'role': 'CUSTOMER'  ?  'role': 'ADMIN'" -ForegroundColor Yellow
Write-Host "6. Click 'Update'" -ForegroundColor White
Write-Host ""

# Option 2: MongoDB Shell Command
Write-Host "???????????????????????????????????????????" -ForegroundColor Cyan
Write-Host "OPTION 2: MongoDB Shell Command" -ForegroundColor Green
Write-Host "???????????????????????????????????????????" -ForegroundColor Cyan
Write-Host ""
Write-Host "Run this command in MongoDB shell:" -ForegroundColor White
Write-Host ""
$mongoCommand = @"
db.users.updateOne(
  { email: "$userEmail" },
  { `$set: { role: "ADMIN" } }
)
"@
Write-Host $mongoCommand -ForegroundColor Yellow
Write-Host ""

# Option 3: API Request (if admin endpoint exists)
Write-Host "???????????????????????????????????????????" -ForegroundColor Cyan
Write-Host "OPTION 3: API Request (requires existing ADMIN)" -ForegroundColor Green
Write-Host "???????????????????????????????????????????" -ForegroundColor Cyan
Write-Host ""
Write-Host "If you have another ADMIN user, use their token:" -ForegroundColor White
Write-Host ""

$apiCommand = @"
`$adminToken = "YOUR_ADMIN_ACCESS_TOKEN"
`$body = @{ role = "ADMIN" } | ConvertTo-Json
Invoke-RestMethod -Uri "$API_URL/users/$userId" ``
  -Method PATCH ``
  -Headers @{ Authorization = "Bearer `$adminToken" } ``
  -ContentType "application/json" ``
  -Body `$body
"@
Write-Host $apiCommand -ForegroundColor Yellow
Write-Host ""

# Option 4: Contact Backend Team
Write-Host "???????????????????????????????????????????" -ForegroundColor Cyan
Write-Host "OPTION 4: Request from Backend Team" -ForegroundColor Green
Write-Host "???????????????????????????????????????????" -ForegroundColor Cyan
Write-Host ""
Write-Host "Send this message to backend team:" -ForegroundColor White
Write-Host ""
$message = @"
Hi Backend Team,

Please change the role of the following user to ADMIN:
- Email: $userEmail
- User ID: $userId
- Current Role: CUSTOMER
- Requested Role: ADMIN

This is needed for full admin access to the frontend application.

Thank you!
"@
Write-Host $message -ForegroundColor Yellow
Write-Host ""

# Verification
Write-Host "???????????????????????????????????????????" -ForegroundColor Cyan
Write-Host "VERIFICATION" -ForegroundColor Green
Write-Host "???????????????????????????????????????????" -ForegroundColor Cyan
Write-Host ""
Write-Host "After the change, verify by logging in:" -ForegroundColor White
Write-Host ""
Write-Host "1. Go to: https://happy-pebble-041ffdb03.3.azurestaticapps.io/login" -ForegroundColor White
Write-Host "2. Login with:" -ForegroundColor White
Write-Host "   Email: $userEmail" -ForegroundColor Yellow
Write-Host "   Password: SIkora1976" -ForegroundColor Yellow
Write-Host "3. Check if you have admin access to all features" -ForegroundColor White
Write-Host ""

Write-Host "? Instructions provided!" -ForegroundColor Green
Write-Host ""
Write-Host "Press any key to exit..."
$null = $Host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")
